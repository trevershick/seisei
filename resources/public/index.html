<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <!--[if lt IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.0.5/es5-shim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script>html5.addElements('todo')</script>
  <![endif]-->
  <script src="vendor/lodash.min.js"></script>

  <script src="vendor/jquery.min.js" type="text/javascript"></script>
  <script src="vendor/bootstrap.min.js"></script>
  <script src="vendor/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/theme-twilight.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/mode-javascript.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/mousetrap.min.js" type="text/javascript" charset="utf-8"></script>
  <script src="vendor/mousetrap-global-bind.min.js" type="text/javascript" charset="utf-8"></script>


  <script src="vendor/riot.min.js"></script>
  <script src="seisei-tags.js" ></script>
  <script src="store.js"></script>

  <link rel="stylesheet" href="vendor/bootstrap.min.css">
  <link rel="stylesheet" href="vendor/font-awesome.min.css">
  <link rel="stylesheet" href="https://bootswatch.com/superhero/bootstrap.min.css"></head>
  <link rel="stylesheet" href="vendor/bootstrap-social.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/keys.css">
  <title>生成 - JSON Generation</title>
<body>
  <messages></messages>
  <editor-app></editor-app>

  <script>
    var router = function(collection, id, action) {
      console.log("route", {collection:collection, id:id, action:action});
      if ("login" === collection && accountStore.loggedIn === false) {
        accountStore.login();
      } else if ("logout" === collection) {
        console.log("routing to logout");
        accountStore.logout();
      } else if ("template" === collection && id) {
        editorStore.loadTemplate(id);
      }
    };
    riot.route(router);

    var accountStore = new MyAccountStore();
    var editorStore = new EditorStore();
    var messageStore = new MessageStore();
    var templateListStore = new TemplateListStore();

    accountStore.init();
    editorStore.init();

    var updateriot= function(eventName) {
      riot.update();
    };

    accountStore.on('change', updateriot);
    editorStore.on('change', updateriot);
    messageStore.on('change', updateriot);
    templateListStore.on('change', updateriot);

    editorStore.on('on-slug', function(newSlug) {
      riot.route("template/" + newSlug);
    });

    messageStore.listen(editorStore);
    messageStore.listen(accountStore);


    accountStore.on("received-account", templateListStore.refresh.bind(templateListStore));

    $(function() {
      riot.mount('editor-app', { accounts: accountStore, editor: editorStore, templates: templateListStore });
      riot.mount('messages', {messages: messageStore.messages.bind(messageStore), close:messageStore.removeMessage.bind(messageStore)});
      riot.route.exec(router);

    });

  </script>

</body>
</html>
